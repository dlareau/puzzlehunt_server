{% extends "staff_base.html" %}
{% block title %}Puzzle Progress{% endblock title %}

{% block includes %}
<script type="text/javascript">
  last_solve_pk = {{last_solve_pk}};
  last_unlock_pk = {{last_unlock_pk}};
  last_submission_pk = {{last_submission_pk}}
</script>

<style type="text/css">
  /* temp style */
  #progress thead tr th {
    vertical-align: bottom;
  }

  #progress tbody tr td {
    padding: 2px;
    width: 30px;
    vertical-align: middle;
    height: 30px;
  }

  #progress thead tr {
    border-top: none;
  }

  #table-container {
    overflow-x: scroll;
  }

  th.rotate {
    /* Something you can count on */
    height: 140px;
    white-space: nowrap;
  }

  th.rotate > div {
    transform: 
      /* Magic Numbers */
      translate(12px, 0px)
      /* 45 is really 360 - 45 */
      rotate(300deg);
    width: 20px;
  }
  th.rotate > div > span {
    border-bottom: 1px solid #ccc;
    padding: 5px 5px;
  }

  @property --p{
    syntax: '<number>';
    inherits: true;
    initial-value: 0;
  }

  .pie {
    --w:20px;
    
    width:var(--w);
    aspect-ratio:1;
    position:relative;
    display:inline-grid;
    place-content:center;
  }
  .pie:before,
  .pie:after {
    content:"";
    position:absolute;
    border-radius:50%;
  }
  .pie:before {
    inset:0;
    background:
      radial-gradient(farthest-side,var(--c) 98%,#0000) top/var(--b) var(--b) no-repeat,
      conic-gradient(var(--c) calc(var(--p)*1%),#0000 0);
  }
  .pie:after {
    inset:calc(50% - var(--b)/2);
    background:var(--c);
    transform:rotate(calc(var(--p)*3.6deg)) translateY(calc(50% - var(--w)/2));
  }
  .no-round:before {
    background-size:0 0,auto;
  }
  .no-round:after {
    content:none;
  }

  #progress .solved {
    background: hsla(128, 100%, 75%, 1);; }

  #progress .available {
    background: hsla(55, 100%, 75%, 1); }
</style>
{% endblock includes %}

{% block content %}
  <h2>Puzzle Progress</h2>
  <div id=table-container>
    <table id='progress' class="table table-bordered border-dark">
      <thead>
        <tr>
          <th>Puzzle</th>
<!--           <th>#M</th>
          <th>#P</th>
          <th class="rotate"><div><span>Last&nbsp;Time</span></div></th> -->
          {% for team in team_list %}
            <th class="rotate"><div><span>
              {{ team.team_name }}
            </span></div></th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for puzzle_dict in sol_list %}
          <tr>
            <td class="leftmost" data-id={{puzzle_dict.puzzle.pk}} style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
              {{ puzzle_dict.puzzle.name }}
            </td>
<!--             <td class='num_metas'></td>
            <td class='num_puzzles'></td>
            <td class='last_time'></td> -->
            {% for team in puzzle_dict.teams %}
              <td id='p{{ team.0 }}t{{ puzzle_dict.team.pk }}' style='text-align:center;'
              {% if team.1 == "locked"%}
                class='unavailable'>
              {% elif team.1 == "unlocked" %}
                class='available' data-date={{ team.2 |date:"U"}}>
                  <div class="pie no-round" style="--p:{% widthratio team.2|add:-55000 300 1 %};--c:slategray;--b:15px"></div>
              {% else %}
                class='solved' data-date={{ team.2 |date:"U"}}>
              {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock content %}
